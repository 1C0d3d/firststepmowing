<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dice Game to 21</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #111;
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }

    h1 {
      font-size: 36px;
      margin-bottom: 10px;
      color: red;
      text-shadow: 0 0 10px red;
    }

    #dice {
      display: flex;
      justify-content: space-around;
      margin-top: 20px;
    }

    .section {
      background-color: #222;
      border-radius: 10px;
      padding: 20px;
      margin: 10px;
      width: 45%;
      box-shadow: 0 0 10px red;
    }

    .dice-display {
      font-size: 24px;
      margin-top: 10px;
    }

    .bubble-btn {
      background-color: red;
      border: none;
      border-radius: 20px;
      color: white;
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      font-size: 16px;
      box-shadow: 0 0 10px red;
      transition: all 0.2s ease;
    }

    .bubble-btn:hover {
      background-color: #ff4d4d;
      box-shadow: 0 0 15px red;
    }

    #result {
      font-size: 24px;
      margin-top: 20px;
      color: red;
      text-shadow: 0 0 10px red;
    }

    #suggestion {
      font-size: 18px;
      color: #ffcccc;
      margin-top: 10px;
    }

    #balance-display, #bet-display {
      font-size: 20px;
      margin-top: 10px;
    }

    #bet-slider {
      width: 200px;
      margin-top: 10px;
    }

    .achievement {
      font-size: 18px;
      color: gold;
      text-shadow: 0 0 5px gold;
      margin-top: 10px;
    }

    #how-to-play-content {
      display: none;
      margin-top: 15px;
      font-size: 16px;
      color: #ccc;
      padding: 10px;
      border: 1px solid red;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>Dice Game to 21</h1>
  <div id="balance-display"></div>
  <div id="bet-display">Bet: $<span id="bet-value">10</span></div>
  <input type="range" id="bet-slider" min="10" max="100" step="10" value="10">
  <div id="dice">
    <div class="section">
      <h2>Dealer</h2>
      <div id="dealer-dice" class="dice-display">-</div>
    </div>
    <div class="section">
      <h2>You</h2>
      <div id="user-dice" class="dice-display">-</div>
    </div>
  </div>
  <div id="suggestion"></div>
  <div id="result"></div>
  <div id="buttons" style="margin-top: 20px;">
    <button class="bubble-btn" onclick="startDealer()">Play</button>
  </div>
  <div class="achievement" id="achievement-section">
    <button class="bubble-btn" onclick="toggleAchievements()">Achievements</button>
    <div id="achievement-info" style="display:none;">
      <p>Get $1000 to unlock the Millionaire Achievement!</p>
      <button class="bubble-btn" onclick="buyAchievement()">Buy ($1000)</button>
    </div>
  </div>
  <div>
    <button class="bubble-btn" onclick="toggleHowToPlay()">How to Play</button>
    <div id="how-to-play-content">
      <p>Get as close to 21 as possible without going over. Roll the dice by clicking Hit. You can only roll up to 5 dice. When you're ready, click Stand. The dealer will try to beat your score without going over 21. Ties will result in the dealer rerolling once. First to win each round earns or loses money based on your bet.</p>
    </div>
  </div>
  <div style="margin-top: 20px;">
    <button class="bubble-btn" onclick="resetGame()">Reset Game</button>
  </div>

  <script>
    let balance = localStorage.getItem('diceBalance') 
      ? parseInt(localStorage.getItem('diceBalance')) 
      : 100;

    const GOAL = 21;
    let bet = 10;
    let dealerDice = [];
    let userDice = [];
    let gameActive = false;
    let dealerRolled = false;
    const achievementPurchased = localStorage.getItem('millionaireAchievement') === 'true';

    const dealerDiceDisplay = document.getElementById('dealer-dice');
    const userDiceDisplay = document.getElementById('user-dice');
    const resultDisplay = document.getElementById('result');
    const suggestionDisplay = document.getElementById('suggestion');
    const balanceDisplay = document.getElementById('balance-display');
    const betDisplay = document.getElementById('bet-value');
    const betSlider = document.getElementById('bet-slider');
    const buttons = document.getElementById('buttons');
    const achievementInfo = document.getElementById('achievement-info');

    betSlider.addEventListener('input', () => {
      bet = parseInt(betSlider.value);
      betDisplay.textContent = bet;
    });

    function rollDie() {
      return Math.floor(Math.random() * 6) + 1;
    }

    function sumDice(arr) {
      return arr.reduce((a, b) => a + b, 0);
    }

    function saveBalance() {
      localStorage.setItem('diceBalance', balance);
    }

    function updateDisplay() {
      dealerDiceDisplay.textContent = dealerDice.join(', ') + " (Total: " + sumDice(dealerDice) + ")";
      userDiceDisplay.textContent = userDice.join(', ') + " (Total: " + sumDice(userDice) + ")";
      balanceDisplay.textContent = "Balance: $" + balance;
      saveBalance();
    }

    function buyAchievement() {
      if (balance >= 1000 && !achievementPurchased) {
        balance -= 1000;
        localStorage.setItem('millionaireAchievement', 'true');
        alert("Achievement Unlocked: Millionaire!");
        updateDisplay();
        achievementInfo.style.display = 'none';
      }
    }

    function toggleAchievements() {
      achievementInfo.style.display = achievementInfo.style.display === 'none' ? 'block' : 'none';
    }

    function startDealer() {
      bet = parseInt(betSlider.value);
      dealerDice = [];
      userDice = [];
      gameActive = true;
      resultDisplay.textContent = '';
      suggestionDisplay.textContent = '';
      dealerRolled = false;

      rollWithAnimation(dealerDice, 2, () => {
        dealerRolled = true;
        updateDisplay();
        buttons.innerHTML = `<button class="bubble-btn" onclick="startUser()">Roll</button>`;
      });
    }

    function startUser() {
      rollWithAnimation(userDice, 2, () => {
        updateDisplay();
        showSuggestion();
        buttons.innerHTML = `
          <button class="bubble-btn" onclick="hit()">Hit</button>
          <button class="bubble-btn" onclick="stand()">Stand</button>
        `;
      });
    }

    function hit() {
      if (userDice.length < 5 && gameActive) {
        rollWithAnimation(userDice, 1, () => {
          updateDisplay();
          if (userDice.length > 3 && sumDice(dealerDice) < 17) {
            dealerDice.push(rollDie());
            updateDisplay();
          }
          if (sumDice(userDice) > GOAL) {
            endGame("You busted! Dealer wins.");
          } else {
            showSuggestion();
          }
        });
      }
    }

    function stand() {
      gameActive = false;
      suggestionDisplay.textContent = '';
      const userTotal = sumDice(userDice);

      // Dealer logic
      while (sumDice(dealerDice) < 17) {
        dealerDice.push(rollDie());
      }

      let dealerTotal = sumDice(dealerDice);

      // Reroll once if dealer ties
      if (dealerTotal === userTotal && dealerTotal <= GOAL) {
        dealerDice.push(rollDie());
        dealerTotal = sumDice(dealerDice);
      }

      updateDisplay();
      evaluateWinner();
    }

    function evaluateWinner() {
      const userTotal = sumDice(userDice);
      const dealerTotal = sumDice(dealerDice);
      let message = "";

      if (dealerTotal > GOAL || userTotal > dealerTotal) {
        balance += bet;
        message = "You win!";
      } else {
        balance -= bet;
        message = "Dealer wins!";
      }

      endGame(message);
    }

    function endGame(message) {
      gameActive = false;
      resultDisplay.textContent = message;
      updateDisplay();
      suggestionDisplay.textContent = '';
      buttons.innerHTML = `<button class="bubble-btn" onclick="startDealer()">Play Again</button>`;
    }

    function rollWithAnimation(targetArray, count, callback) {
      let finalRolls = Array.from({length: count}, rollDie);
      let animationIndex = 0;
      const animationLength = 10;

      const interval = setInterval(() => {
        animationIndex++;
        if (animationIndex >= animationLength) {
          clearInterval(interval);
          for (let i = 0; i < count; i++) {
            targetArray.push(finalRolls[i]);
          }
          updateDisplay();
          callback();
        } else {
          for (let i = 0; i < count; i++) {
            targetArray[targetArray.length - i - 1] = rollDie();
          }
          updateDisplay();
        }
      }, 50);
    }

    function showSuggestion() {
      const total = sumDice(userDice);
      let suggestion = "";

      if (total <= 15) {
        suggestion = "You should hit.";
      } else if (total >= 18) {
        suggestion = "You should stand.";
      } else {
        suggestion = "It's risky. Your call!";
      }

      suggestionDisplay.textContent = suggestion;
    }

    function resetGame() {
      localStorage.removeItem('diceBalance');
      localStorage.removeItem('millionaireAchievement');
      location.reload();
    }

    function toggleHowToPlay() {
      const content = document.getElementById('how-to-play-content');
      content.style.display = content.style.display === 'none' || content.style.display === '' ? 'block' : 'none';
    }

    updateDisplay();
  </script>
</body>
</html>